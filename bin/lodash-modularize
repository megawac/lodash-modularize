#!/usr/bin/env node

var argv = require('yargs')
  .usage('Usage: $0 <input> [options]')
  .example('$0 src/**.js --format amd -o src/lodash.js', 'Generate a build for source files')
  .demand(1)

  .default('outfile', null)
  .alias('o', 'outfile')
  .nargs('o', 1)
  .describe('outfile', 'file to generate')

  .array('format')
  .default('format', ['cjs', 'es6'])
  .alias('f', 'format')
  .nargs('f', 1)
  .describe('format', 'modular format to export (es6,amd,cjs)')

  .default('out-format', 'umd')
  .describe('out-format', 'module format to export (es6,umd,cjs,amd)')

  .default('lodash', 'lodash')
  .describe('lodash', 'The path to search and use for lodash (e.g. lodash-compat)')
  
  .default('global', null)
  .alias('g', 'global')
  .nargs('g', 1)
  .describe('global', 'Global lodash variable (e.g. _ or lodash)')

  .boolean('compile')
  .alias('compile', ['c'])
  .describe('compile', 'Whether to compile the results like lodash cli')

  .boolean('list')
  .describe('list', 'List the use lodash modules instead of building a file')

  .version(function() {
    return require('../package').version;
  })
  .argv;

var modularize = require('..');

// Work around yargs not doing it for us
argv.format = argv.f = argv.f.join(',').split(',');
console.log(argv);

modularize(argv._, argv)
  .then(function(result) {
    if (argv.list) {
      console.log(result.sort().join(','));
      return;
    } else if (!argv.outfile) {
      console.log(result);
    }
  })
  .catch(function(error) {
    console.error(error);
    process.exit(1);
  });

